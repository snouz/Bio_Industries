BI.entered_file()

local BioInd = require('common')('Bio_Industries')

local ICONPATH = BioInd.iconpath
local WOODPATH = BioInd.entitypath .. "wood_products/"

local ENTITYPATH = "__base__/graphics/entity/"
local PIPEPATH = ENTITYPATH .. "pipe/"
local SNDPATH = "__base__/sound/"

require("prototypes.default.entity.entity_remnants_rail")

local sound_def = require("__base__.prototypes.entity.sounds")
local sounds = {}

sounds.car_wood_impact = sound_def.car_wood_impact(0.8)
sounds.generic_impact = sound_def.generic_impact

for _, sound in ipairs(sounds.generic_impact) do
  sound.volume = 0.65
end

sounds.walking_sound = {}
for i = 1, 11 do
  sounds.walking_sound[i] = {
    filename = SNDPATH .. "walking/concrete-" .. (i < 10 and "0" or "")  .. i ..".ogg",
    volume = 1.2
  }
end

------------------------------------------------------------------------------------
--                                 Item subgroups                                 --
------------------------------------------------------------------------------------
local RAIL_FLAGS = {
  "placeable-neutral",
  "player-creation",
  "building-direction-8-way",
  "fast-replaceable-no-cross-type-while-moving"
}

--~ -- Used for Wooden Pipe Pictures
--~ pipepictures_w = function()
  --~ return {
    --~ straight_vertical_single = {
      --~ filename = PIPEPATH .. "pipe-straight-vertical-single.png",
      --~ priority = "extra-high",
      --~ width = 80,
      --~ height = 80,
      --~ hr_version = {
        --~ filename = PIPEPATH .. "hr-pipe-straight-vertical-single.png",
        --~ priority = "extra-high",
        --~ width = 160,
        --~ height = 160,
        --~ scale = 0.5
      --~ }
    --~ },
    --~ straight_vertical = {
      --~ filename = PIPEPATH .. "pipe-straight-vertical.png",
      --~ priority = "extra-high",
      --~ size = 64,
      --~ hr_version = {
        --~ filename = PIPEPATH .. "hr-pipe-straight-vertical.png",
        --~ priority = "extra-high",
        --~ size = 128,
        --~ scale = 0.5
      --~ }
    --~ },
    --~ straight_vertical_window = {
      --~ filename = PIPEPATH .. "pipe-straight-vertical-window.png",
      --~ priority = "extra-high",
      --~ size = 64,
      --~ hr_version = {
        --~ filename = PIPEPATH .. "hr-pipe-straight-vertical-window.png",
        --~ priority = "extra-high",
        --~ size = 128,
        --~ scale = 0.5
      --~ }
    --~ },
    --~ straight_horizontal_window = {
      --~ filename = PIPEPATH .. "pipe-straight-horizontal-window.png",
      --~ priority = "extra-high",
      --~ size = 64,
      --~ hr_version = {
        --~ filename = PIPEPATH .. "hr-pipe-straight-horizontal-window.png",
        --~ priority = "extra-high",
        --~ size = 128,
        --~ scale = 0.5
      --~ }
    --~ },
    --~ straight_horizontal = {
      --~ filename = PIPEPATH .. "pipe-straight-horizontal.png",
      --~ priority = "extra-high",
      --~ size = 64,
      --~ hr_version = {
        --~ filename = PIPEPATH .. "hr-pipe-straight-horizontal.png",
        --~ priority = "extra-high",
        --~ size = 128,
        --~ scale = 0.5
      --~ }
    --~ },
    --~ corner_up_right = {
      --~ filename = PIPEPATH .. "pipe-corner-up-right.png",
      --~ priority = "extra-high",
      --~ size = 64,
      --~ hr_version = {
        --~ filename = PIPEPATH .. "hr-pipe-corner-up-right.png",
        --~ priority = "extra-high",
        --~ size = 128,
        --~ scale = 0.5
      --~ }
    --~ },
    --~ corner_up_left = {
      --~ filename = PIPEPATH .. "pipe-corner-up-left.png",
      --~ priority = "extra-high",
      --~ size = 64,
      --~ hr_version = {
        --~ filename = PIPEPATH .. "hr-pipe-corner-up-left.png",
        --~ priority = "extra-high",
        --~ size = 128,
        --~ scale = 0.5
      --~ }
    --~ },
    --~ corner_down_right = {
      --~ filename = PIPEPATH .. "pipe-corner-down-right.png",
      --~ priority = "extra-high",
      --~ size = 64,
      --~ hr_version = {
        --~ filename = PIPEPATH .. "hr-pipe-corner-down-right.png",
        --~ priority = "extra-high",
        --~ size = 128,
        --~ scale = 0.5
      --~ }
    --~ },
    --~ corner_down_left = {
      --~ filename = PIPEPATH .. "pipe-corner-down-left.png",
      --~ priority = "extra-high",
      --~ size = 64,
      --~ hr_version = {
        --~ filename = PIPEPATH .. "hr-pipe-corner-down-left.png",
        --~ priority = "extra-high",
        --~ size = 128,
        --~ scale = 0.5
      --~ }
    --~ },
    --~ t_up = {
      --~ filename = PIPEPATH .. "pipe-t-up.png",
      --~ priority = "extra-high",
      --~ size = 64,
      --~ hr_version = {
        --~ filename = PIPEPATH .. "hr-pipe-t-up.png",
        --~ priority = "extra-high",
        --~ size = 128,
        --~ scale = 0.5
      --~ }
    --~ },
    --~ t_down = {
      --~ filename = PIPEPATH .. "pipe-t-down.png",
      --~ priority = "extra-high",
      --~ size = 64,
      --~ hr_version = {
        --~ filename = PIPEPATH .. "hr-pipe-t-down.png",
        --~ priority = "extra-high",
        --~ size = 128,
        --~ scale = 0.5
      --~ }
    --~ },
    --~ t_right = {
      --~ filename = PIPEPATH .. "pipe-t-right.png",
      --~ priority = "extra-high",
      --~ size = 64,
      --~ hr_version = {
        --~ filename = PIPEPATH .. "hr-pipe-t-right.png",
        --~ priority = "extra-high",
        --~ size = 128,
        --~ scale = 0.5
      --~ }
    --~ },
    --~ t_left = {
      --~ filename = PIPEPATH .. "pipe-t-left.png",
      --~ priority = "extra-high",
      --~ size = 64,
      --~ hr_version = {
        --~ filename = PIPEPATH .. "hr-pipe-t-left.png",
        --~ priority = "extra-high",
        --~ size = 128,
        --~ scale = 0.5
      --~ }
    --~ },
    --~ cross = {
      --~ filename = PIPEPATH .. "pipe-cross.png",
      --~ priority = "extra-high",
      --~ size = 64,
      --~ hr_version = {
        --~ filename = PIPEPATH .. "hr-pipe-cross.png",
        --~ priority = "extra-high",
        --~ size = 128,
        --~ scale = 0.5
      --~ }
    --~ },
    --~ ending_up = {
      --~ filename = PIPEPATH .. "pipe-ending-up.png",
      --~ priority = "extra-high",
      --~ size = 64,
      --~ hr_version = {
        --~ filename = PIPEPATH .. "hr-pipe-ending-up.png",
        --~ priority = "extra-high",
        --~ size = 128,
        --~ scale = 0.5
      --~ }
    --~ },
    --~ ending_down = {
      --~ filename = PIPEPATH .. "pipe-ending-down.png",
      --~ priority = "extra-high",
      --~ size = 64,
      --~ hr_version = {
        --~ filename = PIPEPATH .. "hr-pipe-ending-down.png",
        --~ priority = "extra-high",
        --~ size = 128,
        --~ scale = 0.5
      --~ }
    --~ },
    --~ ending_right = {
      --~ filename = PIPEPATH .. "pipe-ending-right.png",
      --~ priority = "extra-high",
      --~ size = 64,
      --~ hr_version = {
        --~ filename = PIPEPATH .. "hr-pipe-ending-right.png",
        --~ priority = "extra-high",
        --~ size = 128,
        --~ scale = 0.5
      --~ }
    --~ },
    --~ ending_left = {
      --~ filename = PIPEPATH .. "pipe-ending-left.png",
      --~ priority = "extra-high",
      --~ size = 64,
      --~ hr_version = {
        --~ filename = PIPEPATH .. "hr-pipe-ending-left.png",
        --~ priority = "extra-high",
        --~ size = 128,
        --~ scale = 0.5
      --~ }
    --~ },
    --~ horizontal_window_background = {
      --~ filename = PIPEPATH .. "pipe-horizontal-window-background.png",
      --~ priority = "extra-high",
      --~ size = 64,
      --~ hr_version = {
        --~ filename = PIPEPATH .. "hr-pipe-horizontal-window-background.png",
        --~ priority = "extra-high",
        --~ size = 128,
        --~ scale = 0.5
      --~ }
    --~ },
    --~ vertical_window_background = {
      --~ filename = PIPEPATH .. "pipe-vertical-window-background.png",
      --~ priority = "extra-high",
      --~ size = 64,
      --~ hr_version = {
        --~ filename = PIPEPATH .. "hr-pipe-vertical-window-background.png",
        --~ priority = "extra-high",
        --~ size = 128,
        --~ scale = 0.5
      --~ }
    --~ },
    --~ fluid_background = {
      --~ filename = PIPEPATH .. "fluid-background.png",
      --~ priority = "extra-high",
      --~ width = 32,
      --~ height = 20,
      --~ hr_version = {
        --~ filename = PIPEPATH .. "hr-fluid-background.png",
        --~ priority = "extra-high",
        --~ width = 64,
        --~ height = 40,
        --~ scale = 0.5
      --~ }
    --~ },
    --~ low_temperature_flow = {
      --~ filename = PIPEPATH .. "fluid-flow-low-temperature.png",
      --~ priority = "extra-high",
      --~ width = 160,
      --~ height = 18
    --~ },
    --~ middle_temperature_flow = {
      --~ filename = PIPEPATH .. "fluid-flow-medium-temperature.png",
      --~ priority = "extra-high",
      --~ width = 160,
      --~ height = 18
    --~ },
    --~ high_temperature_flow = {
      --~ filename = PIPEPATH .. "fluid-flow-high-temperature.png",
      --~ priority = "extra-high",
      --~ width = 160,
      --~ height = 18
    --~ },
    --~ gas_flow = {
      --~ filename = PIPEPATH .. "steam.png",
      --~ priority = "extra-high",
      --~ line_length = 10,
      --~ width = 24,
      --~ height = 15,
      --~ frame_count = 60,
      --~ axially_symmetrical = false,
      --~ direction_count = 1,
      --~ hr_version = {
        --~ filename = PIPEPATH .. "hr-steam.png",
        --~ priority = "extra-high",
        --~ line_length = 10,
        --~ width = 48,
        --~ height = 30,
        --~ frame_count = 60,
        --~ axially_symmetrical = false,
        --~ direction_count = 1
      --~ }
    --~ }
  --~ }
--~ end

------------------------------------------------------------------------------------
--                                 Define entities                                --
------------------------------------------------------------------------------------
data:extend({


  -- Straight wooden rails
  {
    type = "straight-rail",
    name = "bi-straight-rail-wood",
    localised_name = {"entity-name.bi-rail-wood"},
    localised_description = {"entity-description.bi-rail-wood"},
    icon = ICONPATH .. "entity/rail-wood.png",
    icon_size = 64,
    BI_add_icon = true,
    --~ flags = {
      --~ "placeable-neutral",
      --~ "player-creation",
      --~ "building-direction-8-way",
      --~ "fast-replaceable-no-cross-type-while-moving",
    --~ },
    flags = RAIL_FLAGS,
    --~ collision_mask = {"object-layer"},
    --~ collision_mask = BioInd.RAIL_MASK,
    minable = {mining_time = 0.25, result = "bi-rail-wood"},
    max_health = 60,
    corpse = "straight-rail-remnants-wood",
    resistances = {
      {
        type = "fire",
        percent = 80
      },
      {
        type = "acid",
        percent = 60
      }
    },
    collision_box = {{-0.7, -0.8}, {0.7, 0.8}},
    selection_box = {{-0.7, -0.8}, {0.7, 0.8}},
    rail_category = "regular",
    --fast_replaceable_group = "rail",
    --next_upgrade = "straight-rail",
    pictures = rail_pictures(),
  },


  -- Curved wooden rails
  {
    type = "curved-rail",
    name = "bi-curved-rail-wood",
    localised_name = {"entity-name.bi-rail-wood"},
    localised_description = {"entity-description.bi-rail-wood"},
    icon = ICONPATH .. "entity/rail-wood-curved.png",
    icon_size = 64,
    BI_add_icon = true,
    --~ flags = {
      --~ "placeable-neutral",
      --~ "player-creation",
      --~ "building-direction-8-way",
      --~ "fast-replaceable-no-cross-type-while-moving"
    --~ },
    flags = RAIL_FLAGS,
    --~ collision_mask = {"object-layer"},
    --~ collision_mask = BioInd.RAIL_MASK,
    minable = {mining_time = 0.25, result = "bi-rail-wood", count = 4},
    max_health = 120,
    corpse = "curved-rail-remnants-wood",
    resistances = {
      {
        type = "fire",
        percent = 80
      },
      {
        type = "acid",
        percent = 60
      }
    },
    collision_box = {{-0.75, -0.55}, {0.75, 1.6}},
    secondary_collision_box = {{-0.65, -2.43}, {0.65, 2.43}},
    selection_box = {{-1.7, -0.8}, {1.7, 0.8}},
    rail_category = "regular",
    pictures = rail_pictures(),
    placeable_by = { item = "bi-rail-wood", count = 4}
  },

  -- Straight wooden rail bridge
  {
    type = "straight-rail",
    name = "bi-straight-rail-wood-bridge",
    localised_name = {"entity-name.bi-rail-wood-bridge"},
    localised_description = {"entity-description.bi-rail-wood-bridge"},
    icon = ICONPATH .. "entity/rail-wood.png",
    icon_size = 64,
    BI_add_icon = true,
    flags = {"placeable-neutral", "player-creation", "building-direction-8-way"},
    --~ collision_mask = {"object-layer"},
--~ collision_mask = { "item-layer", "object-layer"},
    --~ collision_mask = {"ground-tile", "floor-layer", "object-layer", "consider-tile-transitions"},
    --~ collision_mask = BioInd.RAIL_BRIDGE_MASK,
    minable = {mining_time = 0.5, result = "bi-rail-wood-bridge"},
    max_health = 60,
    corpse = "straight-rail-remnants-wood-bridge",
    collision_box = {{-0.7, -0.8}, {0.7, 0.8}},
    selection_box = {{-0.7, -0.8}, {0.7, 0.8}},
    rail_category = "regular",
    pictures = rail_pictures(),
  },

  -- Curved wooden rail bridge
  {
    type = "curved-rail",
    name = "bi-curved-rail-wood-bridge",
    localised_name = {"entity-name.bi-rail-wood-bridge"},
    localised_description = {"entity-description.bi-rail-wood-bridge"},
    icon = ICONPATH .. "entity/rail-wood.png",
    icon_size = 64,
    BI_add_icon = true,
    flags = {
      "placeable-neutral",
      "player-creation",
      "building-direction-8-way"
    },
    --~ collision_mask = {"object-layer"},
--~ collision_mask = { "floor-layer", "item-layer", "object-layer"},
    --~ collision_mask = {"ground-tile", "floor-layer", "object-layer", "consider-tile-transitions"},
    --~ collision_mask = BioInd.RAIL_BRIDGE_MASK,
    minable = {mining_time = 0.5, result = "bi-rail-wood-bridge", count = 4},
    max_health = 120,
    corpse = "curved-rail-remnants-wood-bridge",
    collision_box = {{-0.75, -0.55}, {0.75, 1.6}},
    secondary_collision_box = {{-0.65, -2.43}, {0.65, 2.43}},
    selection_box = {{-1.7, -0.8}, {1.7, 0.8}},
    rail_category = "regular",
    pictures = rail_pictures(),
    placeable_by = { item = "bi-rail-wood-bridge", count = 4}
  },
})

--- Power straight Rail
data:extend({
  {
    type = "straight-rail",
    name = "bi-straight-rail-power",
    localised_name = {"entity-name.bi-rail-power"},
    localised_description = {"entity-description.bi-rail-power"},
    icon = ICONPATH .. "entity/rail-concrete-power.png",
    icon_size = 64,
    BI_add_icon = true,
    flags = {
      "placeable-neutral",
      "player-creation",
      "building-direction-8-way"
    },
    --~ collision_mask = {"object-layer"},
    --~ collision_mask = BioInd.RAIL_MASK,
    minable = {mining_time = 0.5, result = "bi-rail-power"},
    max_health = 60,
    corpse = "straight-rail-remnants",
    collision_box = {{-0.7, -0.8}, {0.7, 0.8}},
    selection_box = {{-0.7, -0.8}, {0.7, 0.8}},
    rail_category = "regular",
    pictures = rail_pictures(),
  },
})

--- Power curved Rail
data:extend({
  {
    type = "curved-rail",
    name = "bi-curved-rail-power",
    localised_name = {"entity-name.bi-rail-power"},
    localised_description = {"entity-description.bi-rail-power"},
    icon = ICONPATH .. "entity/rail-concrete-power.png",
    icon_size = 64,
    BI_add_icon = true,
    flags = {
      "placeable-neutral",
      "player-creation",
      "building-direction-8-way",
    },
    --~ collision_mask = {"object-layer"},
    --~ collision_mask = BioInd.RAIL_MASK,
    minable = {mining_time = 0.5, result = "bi-rail-power", count = 4},
    max_health = 120,
    corpse = "curved-rail-remnants",
    collision_box = {{-0.75, -0.55}, {0.75, 1.6}},
    secondary_collision_box = {{-0.65, -2.43}, {0.65, 2.43}},
    selection_box = {{-1.7, -0.8}, {1.7, 0.8}},
    rail_category = "regular",
    pictures = rail_pictures(),
    placeable_by = { item = "bi-rail-power", count = 4}
  }
})

------ Power to Rail Pole

local my_pole = util.table.deepcopy(data.raw["electric-pole"]["medium-electric-pole"])
my_pole.name = "bi-power-to-rail-pole"
my_pole.icon = ICONPATH .. "entity/rail-concrete-power-pole.png"
my_pole.icon_size = 64
my_pole.BI_add_icon = true
my_pole.icon_mipmaps = 0
my_pole.minable = {mining_time = 1, result = "bi-power-to-rail-pole"}
my_pole.maximum_wire_distance = BioInd.POWER_TO_RAIL_WIRE_DISTANCE
--~ my_pole.pictures.tint = {r = 183/255, g = 125/255, b = 62/255, a = 1}
my_pole.pictures.layers[1].hr_version.tint = {r = 0.9, g = 0.87, b = 0.23, a = 1}
my_pole.pictures.layers[1].tint = {r = 0.9, g = 0.87, b = 0.23, a = 0.5}
data:extend({my_pole})


------------------------------------------------------------------------------------
--                                    END OF FILE                                 --
------------------------------------------------------------------------------------
BI.entered_file("leave")
